{"version":3,"file":"scanCode.js","sources":["pages/scanCode/scanCode.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2NhbkNvZGUvc2NhbkNvZGUudnVl"],"sourcesContent":["<template>\n\t<view class=\"scan-code container\">\n\n\t\t<view class=\"scan-box\">\n\t\t\t<view class=\"scan-frame\">\n\t\t\t\t<camera\n\t\t\t\t\tv-if=\"canUseCamera\"\n\t\t\t\t\tclass=\"camera-view\"\n\t\t\t\t\tdevice-position=\"back\"\n\t\t\t\t\tmode=\"scanCode\"\n\t\t\t\t\tflash=\"off\"\n\t\t\t\t\t@scancode=\"onScanCode\"\n\t\t\t\t\t@error=\"onCameraError\"\n\t\t\t\t/>\n\t\t\t\t<view v-else class=\"camera-placeholder\" @click=\"ensureCameraPermission\">\n\t\t\t\t\t<text>请先授权摄像头以开始扫码</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"scan-hint\">对准二维码/条码自动识别</view>\n\t\t</view>\n\n\t\t<button class=\"album-btn\" type=\"default\" @click=\"pickFromAlbum\">\n\t\t\t相册\n\t\t</button>\n\t</view>\n\n\t<custom-tabbar></custom-tabbar>\n</template>\n\n<script setup>\n\timport customTabbar from '@/components/custom-tabbar/custom-tabbar.vue';\n\timport { onLoad } from '@dcloudio/uni-app';\n\timport { ref } from 'vue';\n\n\tconst isHandlingResult = ref(false);\n\tconst canUseCamera = ref(false);\n\n\tconst handleScanResult = (res) => {\n\t\tif (isHandlingResult.value) return;\n\t\tisHandlingResult.value = true;\n\t\tconsole.log('scan result', res);\n\t\tconst result = res?.result || res?.code || res?.path;\n\t\tif (result) {\n\t\t\tuni.showToast({ title: '签到成功', icon: 'success' });\n\t\t} else {\n\t\t\tuni.showToast({ title: '未能识别，请重试', icon: 'none' });\n\t\t}\n\t\t// 适当延时避免快速重复触发\n\t\tsetTimeout(() => {\n\t\t\tisHandlingResult.value = false;\n\t\t}, 800);\n\t};\n\n\tconst onScanCode = (event) => {\n\t\thandleScanResult(event?.detail);\n\t};\n\n\tconst onCameraError = (err) => {\n\t\tconsole.warn('camera error', err);\n\t\tuni.showToast({ title: '摄像头不可用', icon: 'none' });\n\t};\n\n\tconst requestCameraAuth = () =>\n\t\tnew Promise((resolve) => {\n\t\t\tuni.authorize({\n\t\t\t\tscope: 'scope.camera',\n\t\t\t\tsuccess: () => resolve(true),\n\t\t\t\tfail: () => resolve(false),\n\t\t\t});\n\t\t});\n\n\tconst openSettingForCamera = () =>\n\t\tnew Promise((resolve) => {\n\t\t\tuni.openSetting({\n\t\t\t\tsuccess(res) {\n\t\t\t\t\tresolve(res.authSetting?.['scope.camera'] === true);\n\t\t\t\t},\n\t\t\t\tfail() {\n\t\t\t\t\tresolve(false);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\tconst ensureCameraPermission = async () => {\n\t\tuni.getSetting({\n\t\t\tasync success(res) {\n\t\t\t\tconst hasAuth = res.authSetting?.['scope.camera'] === true;\n\t\t\t\tif (hasAuth) {\n\t\t\t\t\tcanUseCamera.value = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst granted = await requestCameraAuth();\r\n\t\t\t\t\n\t\t\t\tif (granted) {\n\t\t\t\t\tcanUseCamera.value = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tuni.showModal({\n\t\t\t\t\ttitle: '需要摄像头权限',\n\t\t\t\t\tcontent: '请在设置中开启摄像头权限以完成扫码签到',\n\t\t\t\t\tconfirmText: '去设置',\n\t\t\t\t\tsuccess: async (modalRes) => {\n\t\t\t\t\t\tif (modalRes.confirm) {\n\t\t\t\t\t\t\tconst ok = await openSettingForCamera();\n\t\t\t\t\t\t\tcanUseCamera.value = ok;\n\t\t\t\t\t\t\tif (!ok) {\n\t\t\t\t\t\t\t\tuni.showToast({ title: '未开启权限', icon: 'none' });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tfail() {\n\t\t\t\tuni.showToast({ title: '无法获取权限状态', icon: 'none' });\n\t\t\t},\n\t\t});\n\t};\n\n\tconst pickFromAlbum = () => {\n\t\tif (isHandlingResult.value) return;\n\t\tuni.scanCode({\n\t\t\tonlyFromCamera: false, // 从相册选择照片\n\t\t\tscanType: ['qrCode', 'barCode'],\n\t\t\tsuccess(res) {\n\t\t\t\thandleScanResult(res);\n\t\t\t},\n\t\t\tfail(err) {\n\t\t\t\tconsole.warn('choose image failed', err);\n\t\t\t\tuni.showToast({ title: '未能识别，请重试', icon: 'none' });\n\t\t\t},\n\t\t});\n\t};\n\n\tonLoad(() => {\n\t\tensureCameraPermission();\n\t});\n</script>\n\n<style lang=\"scss\" scoped>\n.scan-code.container {\n\tmin-height: 100vh;\n\tpadding: 32rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\tbox-sizing: border-box;\n}\n\n.scan-btn {\n\tmargin-bottom: 24rpx;\n\twidth: 300rpx;\n\theight: 88rpx;\n\tline-height: 88rpx;\n\tbackground: linear-gradient(135deg, #0bb4f0, #4ad1f9);\n\tcolor: #fff;\n\tborder: none;\n\tborder-radius: 16rpx;\n}\n\n.scan-box {\n\twidth: 520rpx;\n\theight: 520rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 32rpx;\n\tbox-sizing: border-box;\n}\n\n.scan-frame {\n\twidth: 100%;\n\theight: 100%;\n\tborder: 4rpx dashed #0bb4f0;\n\tborder-radius: 24rpx;\n\tposition: relative;\n\tbox-sizing: border-box;\n\toverflow: hidden;\n}\n\n.camera-placeholder {\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcolor: #999;\n\tfont-size: 26rpx;\n\tbackground: #f6f6f6;\n}\n\n.camera-view {\n\twidth: 100%;\n\theight: 100%;\n}\n\n.scan-hint {\n\tmargin-top: 24rpx;\n\tfont-size: 28rpx;\n\tcolor: #666;\n}\n\n.album-btn {\n\tmargin-top: 40rpx;\n\twidth: 240rpx;\n\theight: 88rpx;\n\tline-height: 88rpx;\n\tbackground: linear-gradient(135deg, #FCB857 0%, #FF9800 100%);\n\tcolor: #fff;\n\tborder: none;\n\tborder-radius: 16rpx;\n}\n</style>","import MiniProgramPage from 'C:/Users/House/Desktop/graduation-project/campus_activity/pages/scanCode/scanCode.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onLoad"],"mappings":"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"}