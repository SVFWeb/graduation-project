{"version":3,"file":"publishActivity.js","sources":["pages/user/publishActivity/publishActivity.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9wdWJsaXNoQWN0aXZpdHkvcHVibGlzaEFjdGl2aXR5LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"publish-activity container\">\r\n\t\t<uni-forms ref=\"formRef\" :modelValue=\"form\" :rules=\"rules\" label-position=\"top\" label-width=\"120\">\r\n\t\t\t<uni-forms-item label=\"活动名称\" name=\"name\" required>\r\n\t\t\t\t<uni-easyinput v-model=\"form.name\" placeholder=\"请输入活动名称\" />\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item label=\"活动介绍\" name=\"description\" required>\r\n\t\t\t\t<uni-easyinput v-model=\"form.description\" type=\"textarea\" placeholder=\"请填写活动介绍\" :auto-height=\"true\" />\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item label=\"活动类型\" name=\"activityType\" required>\r\n\t\t\t\t<uni-data-select v-model=\"form.activityType\" :localdata=\"typeOptions\" placeholder=\"请选择活动类型\" />\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item label=\"活动地点\" name=\"location\" required>\r\n\t\t\t\t<uni-data-select v-model=\"form.location\" :localdata=\"locationOptions\" placeholder=\"请选择活动地点\" />\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item label=\"活动主办方\" name=\"clubId\" required>\r\n\t\t\t\t<uni-data-select v-model=\"form.clubId\" :localdata=\"organizerOptions\" placeholder=\"请选择主办方\" />\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item label=\"参与须知\" name=\"notice\" required>\r\n\t\t\t\t<uni-easyinput v-model=\"form.notice\" type=\"textarea\" placeholder=\"请填写参与须知\" :auto-height=\"true\" />\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item label=\"活动报名时间\" name=\"signupRange\" required>\r\n\t\t\t\t<uni-datetime-picker v-model=\"form.signupRange\" type=\"datetimerange\" range-separator=\"至\"\r\n\t\t\t\t\tstart-placeholder=\"报名开始时间\" end-placeholder=\"报名结束时间\" :start=\"nowLimit\" :end=\"signupEndLimit\" />\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item label=\"活动开始时间\" name=\"activityRange\" required>\r\n\t\t\t\t<uni-datetime-picker v-model=\"form.activityRange\" type=\"datetimerange\" :disabled=\"form.signupRange==''\"\r\n\t\t\t\t\trange-separator=\"至\" start-placeholder=\"活动开始时间\" end-placeholder=\"活动结束时间\"\r\n\t\t\t\t\t:start=\"activityStartLimit\" />\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item label=\"最大报名人数\" name=\"maxParticipants\" required>\r\n\t\t\t\t<uni-number-box v-model=\"form.maxParticipants\" :min=\"1\" :max=\"9999\" :step=\"1\" background=\"#f5f5f5\" />\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item label=\"人员是否要审核\" name=\"needReview\" required>\r\n\t\t\t\t<uni-data-checkbox v-model=\"form.needReview\" :localdata=\"reviewOptions\" mode=\"button\" />\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item label=\"材料图片上传\" name=\"imageUrls\" required>\r\n\t\t\t\t<uni-file-picker ref=\"filePicker\" v-model=\"form.imageUrls\" fileMediatype=\"image\" limit=\"5\"\r\n\t\t\t\t\t:auto-upload=\"false\" @select=\"selectImageFile\" @success=\"successImageFile\" />\r\n\t\t\t\t<view class=\"tip-text\">至少上传 1 张，最多 5 张图片</view>\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<button class=\"submit-btn\" type=\"primary\" @click=\"handleSubmit\">提交</button>\r\n\t\t</uni-forms>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tcomputed,\r\n\t\tonMounted,\r\n\t\treactive,\r\n\t\tref\r\n\t} from 'vue'\r\n\timport {\r\n\t\tapiGetClubManageList\r\n\t} from '@/api/club/index.js'\r\n\timport {\r\n\t\tapiCreateActivity\r\n\t} from '@/api/activity/index.js'\r\n\r\n\tconst userId = uni.getStorageSync('userInfo').id\r\n\tconst formRef = ref(null)\r\n\tconst filePicker = ref(null)\r\n\tconst form = reactive({\r\n\t\tname: '',\r\n\t\tdescription: '',\r\n\t\tactivityType: '',\r\n\t\tlocation: '',\r\n\t\tclubId: '',\r\n\t\tnotice: '',\r\n\t\tsignupRange: [],\r\n\t\tactivityRange: [],\r\n\t\tmaxParticipants: '1',\r\n\t\tneedReview: '1',\r\n\t\timageUrls: [] // 上传材料\r\n\t})\r\n\r\n\tconst nowLimit = Date.now()\r\n\t// 报名结束不可晚于活动开始；活动开始不可早于报名结束\r\n\tconst signupEndLimit = computed(() => form.activityRange?.[0] || '')\r\n\tconst activityStartLimit = computed(() => form.signupRange?.[1] || '')\r\n\tconst organizerOptions = ref([])\r\n\r\n\tconst typeOptions = [{\r\n\t\t\ttext: '思想成长',\r\n\t\t\tvalue: '思想成长'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: '实践实习',\r\n\t\t\tvalue: '实践实习'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: '公益志愿',\r\n\t\t\tvalue: '公益志愿'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: '创新创业',\r\n\t\t\tvalue: '创新创业'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: '文化艺体',\r\n\t\t\tvalue: '文化艺体'\r\n\t\t}\r\n\t]\r\n\r\n\tconst locationOptions = [{\r\n\t\t\ttext: '主楼报告厅',\r\n\t\t\tvalue: '主楼报告厅'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: '体育馆',\r\n\t\t\tvalue: '体育馆'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: '教学楼',\r\n\t\t\tvalue: '教学楼'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: '图书馆',\r\n\t\t\tvalue: '图书馆'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: '户外场地',\r\n\t\t\tvalue: '户外场地'\r\n\t\t}\r\n\t]\r\n\r\n\tconst reviewOptions = [{\r\n\t\t\ttext: '需要审核',\r\n\t\t\tvalue: '1'\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: '无需审核',\r\n\t\t\tvalue: '0'\r\n\t\t}\r\n\t]\r\n\r\n\tconst rules = {\r\n\t\tname: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请填写活动名称'\r\n\t\t\t}]\r\n\t\t},\r\n\t\tdescription: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请填写活动介绍'\r\n\t\t\t}]\r\n\t\t},\r\n\t\tactivityType: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请选择活动类型'\r\n\t\t\t}]\r\n\t\t},\r\n\t\tlocation: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请选择活动地点'\r\n\t\t\t}]\r\n\t\t},\r\n\t\tclubId: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请选择主办方'\r\n\t\t\t}]\r\n\t\t},\r\n\t\tnotice: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请填写参与须知'\r\n\t\t\t}]\r\n\t\t},\r\n\t\tsignupRange: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请选择报名时间'\r\n\t\t\t}]\r\n\t\t},\r\n\t\tactivityRange: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请选择活动时间'\r\n\t\t\t}]\r\n\t\t},\r\n\t\tmaxParticipants: {\r\n\t\t\trules: [{\r\n\t\t\t\t\trequired: true,\r\n\t\t\t\t\terrorMessage: '请输入最大报名人数'\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tvalidateFunction: (rule, value, data, callback) => {\r\n\t\t\t\t\t\tconst num = Number(value)\r\n\t\t\t\t\t\tif (Number.isNaN(num) || num <= 0 || !Number.isInteger(num)) {\r\n\t\t\t\t\t\t\tcallback('请输入正整数')\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\tneedReview: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: '请选择是否需要审核'\r\n\t\t\t}]\r\n\t\t},\r\n\t\timageUrls: {\r\n\t\t\trules: [{\r\n\t\t\t\t\trequired: true,\r\n\t\t\t\t\terrorMessage: '请至少上传 1 张图片'\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tvalidateFunction: (rule, value, data, callback) => {\r\n\t\t\t\t\t\tif (!Array.isArray(value) || value.length < 1) {\r\n\t\t\t\t\t\t\tcallback('请至少上传 1 张图片')\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (value.length > 5) {\r\n\t\t\t\t\t\t\tcallback('最多上传 5 张图片')\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t}\r\n\r\n\tfunction selectImageFile(e) {\r\n\t\tform.imageUrls = e.tempFiles\r\n\t}\r\n\r\n\tasync function successImageFile(e) {\r\n\t\tlet imageUrls = e.tempFiles.map(item => item.url)\r\n\t\tlet fomData = {\r\n\t\t\t...form,\r\n\t\t\timageUrls,\r\n\t\t\tregistrationStartTime: form.signupRange[0],\r\n\t\t\tregistrationEndTime: form.signupRange[1],\r\n\t\t\tstartTime: form.activityRange[0],\r\n\t\t\tendTime: form.activityRange[1],\r\n\t\t\tneedAudit:form.needReview=='1'?true:false\r\n\t\t}\r\n\r\n\t\tlet res = await apiCreateActivity(fomData)\r\n\r\n\t\tif (res.code == 200) {\r\n\t\t\tuni.hideLoading()\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\turl: '/pages/user/user'\r\n\t\t\t\t})\r\n\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '创建成功',\r\n\t\t\t\t\ticon: 'success'\r\n\t\t\t\t})\r\n\t\t\t}, 1000)\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleSubmit = async () => {\r\n\t\ttry {\r\n\t\t\t// 主动触发表单校验\r\n\t\t\tawait formRef.value.validate()\r\n\t\t\t\r\n\t\t\tawait filePicker.value.upload()\r\n\r\n\t\t\tuni.showLoading()\r\n\r\n\r\n\t\t} catch (e) {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '请完善信息',\r\n\t\t\t\ticon: 'error'\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tonMounted(async () => {\r\n\t\tlet res = await apiGetClubManageList(userId)\r\n\t\torganizerOptions.value = res.data.items\r\n\t})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.publish-activity {\r\n\t\tbackground: #f7f8fa;\r\n\t\tmin-height: 100vh;\r\n\t}\r\n\r\n\t.uni-forms {\r\n\t\tbackground: #ffffff;\r\n\t\tborder-radius: 16rpx;\r\n\t\tpadding: 24rpx;\r\n\t\tbox-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.04);\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: 12rpx;\r\n\t}\r\n\r\n\t.tip-text {\r\n\t\tmargin-top: 8rpx;\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.submit-btn {\r\n\t\tmargin-top: 32rpx;\r\n\t\twidth: 100%;\r\n\t}\r\n</style>","import MiniProgramPage from 'C:/Users/House/Desktop/graduation-project/campus_activity/pages/user/publishActivity/publishActivity.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","reactive","computed","apiCreateActivity","onMounted","apiGetClubManageList"],"mappings":"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"}